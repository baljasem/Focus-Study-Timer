<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Study Timer</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#020617">
  <link rel="icon" href="icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    body{margin:0;padding:16px;font-family:system-ui,sans-serif;background:#020617;color:#e5e7eb;text-align:center;overflow:hidden;}
    h1{font-size:22px;margin-bottom:8px}
    label{display:block;margin-top:10px;font-size:14px;color:#cbd5f5}
    select,button{padding:8px 12px;margin:6px;font-size:16px;border-radius:10px;border:none;}
    .primary{background:#38bdf8;color:#020617}
    .secondary{background:#334155;color:#e5e7eb}
    .danger{background:#dc2626;color:white;position:fixed;bottom:16px;right:16px;z-index:10;}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:16px;}
    .box{padding:14px;border-radius:14px;border:2px solid #334155;font-size:18px;}
    .active{border-color:#38bdf8}
    .done{border-color:#22c55e}
    .breakBox{border-color:#e5e7eb;background:#f8fafc;color:#020617}
    .hidden{display:none}
    .history{text-align:left;margin-top:16px;font-size:14px}
  </style>
</head>
<body>

<h1>Focus Study Timer</h1>

<div id="home">
  <label>Session duration</label>
  <select id="hours"></select> : <select id="minutes"></select>

  <label>Box duration (minutes)</label>
  <select id="boxDuration"></select>

  <label>Break after session (minutes)</label>
  <select id="breakDuration">
    <option value="0">No break</option>
  </select>

  <br>
  <button class="primary" onclick="startSession()">Start Session</button>
  <button class="secondary" onclick="showHistory()">Previous Sessions</button>
</div>

<div id="grid" class="grid hidden"></div>
<button class="danger hidden" id="cancelBtn" onclick="cancelSession()">Cancel</button>
<div id="history" class="history hidden"></div>

<script>
let boxes=[], sessionStart=0, totalSeconds=0;

const h=document.getElementById("hours");
const m=document.getElementById("minutes");
const b=document.getElementById("boxDuration");
const br=document.getElementById("breakDuration");

for(let i=1;i<=8;i++) h.innerHTML+=`<option>${i}</option>`;
for(let i=0;i<60;i+=5) m.innerHTML+=`<option>${i}</option>`;
[5,10,15,20,25].forEach(v=>b.innerHTML+=`<option>${v}</option>`);
[5,10,15,20].forEach(v=>br.innerHTML+=`<option>${v}</option>`);

function startSession(){
  document.getElementById("home").classList.add("hidden");
  document.getElementById("grid").classList.remove("hidden");
  document.getElementById("cancelBtn").classList.remove("hidden");

  const totalMin=(+h.value*60)+(+m.value);
  const boxMin=+b.value;
  totalSeconds=totalMin*60;
  sessionStart=Date.now();

  const grid=document.getElementById("grid");
  grid.innerHTML="";
  boxes=[];

  const count=Math.floor(totalMin/boxMin);
  for(let i=0;i<count;i++){
    let d=document.createElement("div");
    d.className="box";
    d.textContent=boxMin+":00";
    grid.appendChild(d);
    boxes.push({el:d,dur:boxMin*60});
  }

  requestAnimationFrame(loop);
}

function loop(){
  let elapsed=Math.floor((Date.now()-sessionStart)/1000);
  let acc=0;

  boxes.forEach(b=>{
    if(elapsed>=acc+b.dur){ b.el.className="box done"; }
    else if(elapsed>=acc){ b.el.className="box active"; }
    acc+=b.dur;
  });

  if(elapsed<totalSeconds) requestAnimationFrame(loop);
}

function cancelSession(){ location.reload(); }
function showHistory(){ alert("History saved locally."); }

// Register Service Worker
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./sw.js");
}
</script>

</body>
</html>
